
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Brad Teller</title>
  <meta name="author" content="Brad Teller">

  
  <meta name="description" content="Not sure about the rest of you out there, but we are still utilizing a hand rolled data access layer. In certain cases we can make use of ORM tools, &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://bradteller.com/posts/5">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Brad Teller" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=Fjalla+One" rel="stylesheet" type="text/css">
<!--- MathJax Configuration -->
<script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
  

</head>

<body   class="collapse-sidebar sidebar-footer" >
  <header role="banner"><hgroup>
  <h1><a href="/">Brad Teller</a></h1>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscribe" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS" target="_blank"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="25" height="25" viewbox="0 0 100 100"><path class="social" d="M 13.310204,73.332654 C 5.967347,73.332654 0,79.322448 0,86.621428 c 0,7.338776 5.967347,13.262246 13.310204,13.262246 7.370408,0 13.328572,-5.92245 13.328572,-13.262246 0,-7.29898 -5.958164,-13.288774 -13.328572,-13.288774 z M 0.01530612,33.978572 V 53.143878 C 12.493878,53.143878 24.229592,58.02347 33.068368,66.865306 41.894898,75.685714 46.767346,87.47449 46.767346,100 h 19.25 C 66.017346,63.592858 36.4,33.979592 0.01530612,33.978572 l 0,0 z M 0.03877552,0 V 19.17449 C 44.54796,19.17551 80.77551,55.437756 80.77551,100 H 100 C 100,44.87653 55.15102,0 0.03877552,0 z"></path></svg></a></li>
  
</ul>
  
  
  
  
  
<ul class="subscribe">
  <li><a href="https://github.com/bteller" rel="subscribe-github" title="@bteller on GitHub" target="_blank"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="25" height="25" viewbox="0 0 100 100"><path class="social" d="M 50,0 C 22.385714,0 0,22.385714 0,50 0,77.614286 22.385714,100 50,100 77.614286,100 100,77.614286 100,50 100,22.385714 77.614286,0 50,0 z m 29.692858,79.692858 c -3.859184,3.859182 -8.351022,6.887754 -13.35,9.00306 -1.27041,0.536736 -2.560204,1.009184 -3.867348,1.415306 v -7.493878 c 0,-3.938774 -1.35102,-6.835714 -4.053062,-8.690816 1.692858,-0.163264 3.24694,-0.390816 4.663266,-0.683672 1.416326,-0.292858 2.913266,-0.716328 4.491838,-1.27041 1.57857,-0.55408 2.994896,-1.213264 4.247958,-1.97755 1.253062,-0.765306 2.458164,-1.758164 3.613266,-2.978572 1.155102,-1.220408 2.12449,-2.604082 2.905102,-4.15 0.780612,-1.545918 1.4,-3.40204 1.855102,-5.566326 0.455102,-2.164286 0.683674,-4.54898 0.683674,-7.153062 0,-5.045918 -1.643878,-9.341836 -4.931634,-12.890816 C 77.44796,33.35 77.285714,29.10204 75.463266,24.512244 l -1.22143,-0.145918 c -0.845918,-0.09796 -2.368366,0.260204 -4.565306,1.07449 -2.196938,0.814286 -4.663264,2.14796 -7.396938,4.004082 -3.87449,-1.07449 -7.893878,-1.611224 -12.061224,-1.611224 -4.19898,0 -8.203062,0.536734 -12.012246,1.611224 -1.72449,-1.17245 -3.361224,-2.139796 -4.907142,-2.905102 C 31.753062,25.77449 30.516326,25.254082 29.587756,24.97653 28.660204,24.7 27.79796,24.528572 27,24.463266 c -0.79796,-0.0653 -1.310204,-0.08062 -1.537756,-0.04898 -0.22755,0.03164 -0.390816,0.0653 -0.487754,0.09796 -1.82347,4.62245 -1.985714,8.87143 -0.487756,12.743878 -3.287754,3.54796 -4.931632,7.844898 -4.931632,12.890816 0,2.604082 0.227552,4.988776 0.683674,7.153062 0.456122,2.164286 1.07449,4.020408 1.855102,5.566326 0.780612,1.545918 1.75,2.929592 2.905102,4.15 1.155102,1.220408 2.360204,2.213266 3.613264,2.978572 1.253062,0.766326 2.669388,1.42449 4.24796,1.97755 1.578572,0.554082 3.07551,0.976532 4.491836,1.27041 1.416328,0.292856 2.970408,0.521428 4.663266,0.683672 -2.669388,1.82347 -4.004082,4.720408 -4.004082,8.690816 v 7.639796 C 36.536734,89.818368 35.083674,89.3 33.656122,88.695918 c -4.99898,-2.115306 -9.490816,-5.143878 -13.35,-9.00306 -3.859184,-3.859184 -6.887754,-8.351022 -9.00306,-13.35 C 9.1163263,61.171428 8.0071428,55.67347 8.0071428,50 c 0,-5.67347 1.1091835,-11.171428 3.2969392,-16.342858 2.115306,-4.998978 5.143878,-9.490816 9.00306,-13.35 3.859184,-3.859182 8.351022,-6.887754 13.35,-9.00306 C 38.828572,9.1163266 44.32653,8.0071428 50,8.0071428 c 5.67347,0 11.171428,1.1091838 16.342858,3.2969392 5,2.115306 9.490816,5.143878 13.35,9.00306 3.859182,3.859184 6.887754,8.351022 9.00306,13.35 2.186736,5.17245 3.295918,10.67041 3.295918,16.342858 0,5.672448 -1.109182,11.171428 -3.296938,16.342858 -2.115306,4.998978 -5.143878,9.490816 -9.00204,13.35 l 0,0 z"></path></svg></a></li>
</ul>
  
  
  
<ul class="subscribe">
  <li><a href="https://twitter.com/bradteller" rel="subscribe-twitter" title="@bradteller on Twitter" target="_blank"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="25" height="25" viewBox="0 0 512 512"><path class="social" d="M0.001,334.932c33.327,30.816,118.891,59.981,188.517-8.271c-12.52,1.955-22.972-0.416-30.913-8.269
  c-7.531-7.465-7.945-15.182-3.914-22.202c3.275-5.725,10.184-9.741,16.977-13.934c-12.323,2.285-22.829,1.095-32.218-3.706
  c-12.604-6.444-24.863-13.228-28.3-27.207c7.71-8.112,16.28-15.359,34.831-12.627c-17.45-5.83-33.087-13.429-44.41-24.815
  c-11.028-11.091-12.163-18.302-13.932-26.996c9.632-3.567,19.688-5.421,30.478-4.353c-24.397-12.476-34.757-29.63-40.487-48.325
  c-1.731-5.652-2.044-11.03-1.31-16.545c98.826,37.305,145.11,64.109,170.662,89.251c11.496-30.589,38.3-99.868,78.371-123.646
  c0.191,3.77-1.309,7.837-4.357,12.189c11.863-6.609,21.125-17.188,37.445-16.98c-1.879,7.723-7.279,13.904-17.85,17.854
  c10.662-4.084,21.463-7.545,32.65-9.578c10.375-1.881,10.229,6.304,4.355,10.444c-11.916,8.412-24.578,9.456-37.006,13.498
  c38.105,0.949,69.266,18.994,93.604,58.343c8.088,13.074,13.52,26.149,14.807,40.487c16.254,4.563,32.426,5.494,48.76,2.61
  c4.475-0.796,8.645-1.63,12.627-3.482c-6.354,9.529-13.686,17.356-23.947,20.899c-9.811,3.387-19.637,6.688-30.473,6.968
  c17.641,6.675,37.082,7.045,57.033,5.659c-24.402,23.486-43.08,22.922-61.824,22.642c-8.221,34.703-25.025,69.315-60.52,101.005
  c-46.559,41.569-96.678,61.397-148.457,65.742c-48.552,4.07-95.488,3.512-146.726-20.464
  C56.486,393.349,24.648,368.884,0.001,334.932L0.001,334.932z"/></svg></a></li>
</ul>
  
  
  
  
  
  
    
      <form action="https://www.google.com/search" method="get">
        <fieldset role="search">
          <input type="hidden" name="sitesearch" value="bradteller.com" />
    
          <input class="search" type="text" name="q" results="0" placeholder="Search"/>
        </fieldset>
      </form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2011/09/02/delegate-assist-in-dal/">Delegate Assist in the DAL</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2011-09-02T00:00:00-04:00'><span class='date'><span class='date-month'>Sep</span> <span class='date-day'>2</span><span class='date-suffix'>nd</span>, <span class='date-year'>2011</span></span> <span class='time'>12:00 am</span></time>
        
        
      </p>
    
  </header>


  <div class="entry-content"><p>Not sure about the rest of you out there, but we are still utilizing a hand rolled data access layer. In certain cases we can make use of ORM tools, but for others we still need the additional control allowed by writing our own. One common task we do is to perform straight read queries into the database and then convert the returned result into a list of business objects. This gets very tedious and time consuming what with writing all the using statements. Also, if you consider the iteration over records in the data reader, that code isn&rsquo;t unique. So, if you want to reduce the overall amount of code this would be a great time to make use of delegates and generics. The code below should get you closer to something just a bit more manageable, since I know we all hate writing any more code than we absolutely have to.</p>

<p>First we define our delegate. We&rsquo;ll use this to tell our function what conversion function it should use for each object type.</p>

<div class="highlight"><pre><code class="language-vbnet" data-lang="vbnet"><span class="k">Public</span> <span class="k">Delegate</span> <span class="k">Function</span> <span class="nf">GetItemFromReader</span><span class="p">(</span><span class="k">Of</span> <span class="n">T</span><span class="p">)(</span><span class="k">ByVal</span> <span class="n">dr</span> <span class="ow">As</span> <span class="n">IDataReader</span><span class="p">)</span></code></pre></div>


<p>Then we can write a reusable function that will accepts an instance of our delegate as a parameter. We have some other helper functions out there which is where the &lsquo;Me.ExecuteReader&rsquo; call comes into play, but you could replace this with the traditional &lsquo;Using cn as New SqlConnection(_connString) &hellip;. End Using&rsquo; code.</p>

<div class="highlight"><pre><code class="language-vbnet" data-lang="vbnet"><span class="k">Public</span> <span class="k">Function</span> <span class="nf">GetListFromReader</span><span class="p">(</span><span class="k">Of</span> <span class="n">T</span><span class="p">)(</span><span class="k">ByVal</span> <span class="n">sprocName</span> <span class="ow">As</span> <span class="kt">String</span><span class="p">,</span> <span class="n">_</span>
          <span class="k">ByVal</span> <span class="n">params</span> <span class="ow">As</span> <span class="n">SqlParameter</span><span class="p">(),</span> <span class="n">_</span>
          <span class="k">ByVal</span> <span class="n">converter</span> <span class="ow">As</span> <span class="n">GetItemFromReader</span><span class="p">(</span><span class="k">Of</span> <span class="n">T</span><span class="p">))</span> <span class="ow">As</span> <span class="n">List</span><span class="p">(</span><span class="k">Of</span> <span class="n">T</span><span class="p">)</span>
 
    <span class="k">Dim</span> <span class="n">result</span> <span class="ow">As</span> <span class="k">New</span> <span class="n">List</span><span class="p">(</span><span class="k">Of</span> <span class="n">T</span><span class="p">)</span>

    <span class="k">Using</span> <span class="n">dr</span> <span class="ow">As</span> <span class="n">SqlDataReader</span> <span class="o">=</span> <span class="k">Me</span><span class="p">.</span><span class="n">ExecuteReader</span><span class="p">(</span><span class="n">sprocName</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
        <span class="k">While</span> <span class="n">dr</span><span class="p">.</span><span class="n">Read</span>
            <span class="n">result</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">converter</span><span class="p">(</span><span class="n">dr</span><span class="p">))</span>
        <span class="k">End</span> <span class="k">While</span>
    <span class="k">End</span> <span class="k">Using</span>
 
    <span class="k">Return</span> <span class="n">result</span>
<span class="k">End</span> <span class="k">Function</span></code></pre></div>


<p>And then we can go ahead and consume it.</p>

<div class="highlight"><pre><code class="language-vbnet" data-lang="vbnet"><span class="k">Public</span> <span class="k">Function</span> <span class="nf">GetUsers</span><span class="p">()</span> <span class="ow">As</span> <span class="n">ICollection</span><span class="p">(</span><span class="k">Of</span> <span class="n">User</span><span class="p">)</span>
    <span class="k">Return</span> <span class="n">GetListFromReader</span><span class="p">(</span><span class="k">Of</span> <span class="n">User</span><span class="p">)(</span><span class="s">&quot;getUsers&quot;</span><span class="p">,</span> <span class="k">Nothing</span><span class="p">,</span> <span class="ow">AddressOf</span> <span class="n">GetUserFromDataReader</span><span class="p">)</span>
<span class="k">End</span> <span class="k">Function</span></code></pre></div>


<p>The code that does the conversion is:</p>

<div class="highlight"><pre><code class="language-vbnet" data-lang="vbnet"><span class="k">Private</span> <span class="k">Function</span> <span class="nf">GetUserFromDataReader</span><span class="p">(</span><span class="k">ByVal</span> <span class="n">dr</span> <span class="ow">As</span> <span class="n">IDataReader</span><span class="p">)</span> <span class="ow">As</span> <span class="n">User</span>
    <span class="k">Return</span> <span class="k">New</span> <span class="n">User</span> <span class="k">With</span> <span class="p">{.</span><span class="n">Id</span> <span class="o">=</span> <span class="n">dr</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">),</span> <span class="p">.</span><span class="n">Name</span> <span class="o">=</span> <span class="n">dr</span><span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">)}</span>
<span class="k">End</span> <span class="k">Function</span></code></pre></div>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2011/08/31/what-up-with-massive/">What's Up With Massive?</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2011-08-31T00:00:00-04:00'><span class='date'><span class='date-month'>Aug</span> <span class='date-day'>31</span><span class='date-suffix'>st</span>, <span class='date-year'>2011</span></span> <span class='time'>12:00 am</span></time>
        
        
      </p>
    
  </header>


  <div class="entry-content"><p>For starters I really like <a href="http://blog.wekeroad.com/">Rob Conery</a> and find the posts he puts out to be some of the most informative of any blogs I subscribe to. I had tried looking at Massive several months ago back when he first started blogging about it, but I was having some problems falling in love with it. If you aren&rsquo;t familiar with it you can find out more <a href="https://github.com/robconery/massive">here</a>. Now looking back I didn&rsquo;t really love it because at the time I didn&rsquo;t understand it. To me it looked like we were tightly coupling the data-access code with the business object, which for me has always been a no-no (ala seperation of concerns). But, apparently after playing around with it for just a short period of time, that is not the case at all.</p>

<p>This post will hopefully evolve as I experiment with it some more, but for now I&rsquo;ve published the code out to a GitHub <a href="https://github.com/bteller/tryoutmassive">repo</a>. It is bare bones at the moment, just some work with some &ldquo;products&rdquo;. This is an MVC 3 application that I&rsquo;m using, and I also sprinkled some <a href="http://twitter.github.com/bootstrap/">Bootstrap</a> from Twitter on top. I haven&rsquo;t ever done anything with Bootstrap, so that will be another learning experience as I go. Though I will say at the moment I suspect it will take some work to get it and jquery playing nicely together. I added some validation to the create form and I already am not happy with what I see (so hopefully I&rsquo;ll get that worked out as well).</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2011/04/29/persistence-ignorant/">Persistence Ignorant</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2011-04-29T00:00:00-04:00'><span class='date'><span class='date-month'>Apr</span> <span class='date-day'>29</span><span class='date-suffix'>th</span>, <span class='date-year'>2011</span></span> <span class='time'>12:00 am</span></time>
        
        
      </p>
    
  </header>


  <div class="entry-content"><p>I&rsquo;ve wasted more time than I would like to admit tonight trying to work out a few things for an open source pet project of mine that I&rsquo;m finally trying to breathe some life into. There were, well I guess still are, a few issues I was trying to deal with.</p>

<ul>
<li>I&rsquo;m not in love with code first</li>
<li>MySql works best for my hosting company, but MySql sucks</li>
<li>At the end of the day I hate SQL the most</li>
</ul>


<p>Some explanation here &hellip;</p>

<p><strong>I&rsquo;m not in love with code first</strong>. At first it seems very appealing, and I&rsquo;m not entirely convinced at this point I will be trying to avoid it, but I have some problems using it for building anything more than a very basic, spin it up once and never maintain it, site. Perhaps the documentation is forthcoming, but I have yet to see any guidance from the folks over at Microsoft to indicate how to handle updates to existing schemas without overwriting all of the data contained in any of the tables you&rsquo;d be modifying. It has support so that you can pass in your own custom implementation of <code>IDatabaseInitializer</code> if you want (a decent overview can be found <a href="http://sankarsan.wordpress.com/2010/10/14/entity-framework-ctp-4-0-database-initialization/">here</a>). But basically you are talking about the code below being used to setup your context.</p>

<div class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="k">public</span> <span class="k">class</span> <span class="nc">FreedomContext</span> <span class="p">:</span> <span class="n">DbContext</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="n">DbSet</span><span class="p">&lt;</span><span class="n">User</span><span class="p">&gt;</span> <span class="n">Users</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="n">DbSet</span><span class="p">&lt;</span><span class="n">Calendar</span><span class="p">&gt;</span> <span class="n">Calendars</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="n">DbSet</span><span class="p">&lt;</span><span class="n">Task</span><span class="p">&gt;</span> <span class="n">Tasks</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    
    <span class="k">public</span> <span class="nf">FreedomContext</span><span class="p">()</span> <span class="p">:</span> <span class="k">base</span><span class="p">(</span><span class="n">nameOrConnectionString</span><span class="p">:</span><span class="s">&quot;FreedomDataServices&quot;</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">base</span><span class="p">.</span><span class="n">Configuration</span><span class="p">.</span><span class="n">AutoDetectChangesEnabled</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
        <span class="n">Database</span><span class="p">.</span><span class="n">SetInitializer</span><span class="p">&lt;</span><span class="n">FreedomContext</span><span class="p">&gt;(</span><span class="k">new</span> <span class="n">DropCreateDatabaseIfModelChanges</span><span class="p">&lt;</span><span class="n">FreedomContext</span><span class="p">&gt;());</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></div>


<p>Unless of course you want to spell out all of the relationships on your own, and in that case you&rsquo;d have to override OnModelCreating and deal with that mess of code. But with this code above, if you&rsquo;ve changed any of your objects then we are going to recreate everything. It appears that Microsoft is actively working on a project to provide better support for migrations, but from what I can tell it isn&rsquo;t actually available at this time (<a href="http://blogs.msdn.com/b/efdesign/archive/2010/10/22/code-first-database-evolution-aka-migrations.aspx">http://blogs.msdn.com/b/efdesign/archive/2010/10/22/code-first-database-evolution-aka-migrations.aspx</a>).</p>

<p><strong>MySql works best for my hosting company, but MySql sucks</strong>. I realize this so before I went too far along I figured I&rsquo;d take and point Entity Framework over at a local instance of MySql just to get ahead of the game. This introduced its own set of problems though, since there appear to be limitations to the connector provided by the folks over at MySql. The main limitation is that you can&rsquo;t even get the drop and recreate type functionality that the code block above demanded because the provider doesn&rsquo;t have any support for it. I hit my head up against that for a while before finally giving up. I had seen indications that you could create the database manually before launching the application, and then everything would behave normally, but that didn&rsquo;t prove to be the case. Another thing I noticed is that there is a NuGet package out there for this, but it doesn&rsquo;t add the necessary sections in your .config file to register MySql with the database factories, so if you haven&rsquo;t ran the installation for the .Net connector you are screwed.</p>

<p>Another issue I have with MySql, and this could just be a knowledge gap, but I was pretty pissed that it wasn&rsquo;t straight forward, is that you can&rsquo;t control the case of characters in your table names. In order to seamlessly use MySql with Entity Framework, we&rsquo;d want to have table names like Users and Calendars, but MySql likes to rename them to users and calendars. I saw noted somewhere that this may only happen when you introduce foreign keys, and somewhere else noted that this has something to do with the case insensitivity of the Windows file system. That isn&rsquo;t correct though. I will say that I&rsquo;m trying to use the MySql Workbench to manage everything as a substitute to SSMS, and it has a problem if you try and alter an existing table, say Users, unless you change the name to users, which then changes the database name. You can afterwards then alter users all you want and the name persists. The option available to you here, which might be what I&rsquo;ll use so I can stay on MySql throughout this process, is to follow a more traditional Entity Framework POCO pattern, <a href="http://blogs.msdn.com/b/adonet/archive/2009/05/21/poco-in-the-entity-framework-part-1-the-experience.aspx">http://blogs.msdn.com/b/adonet/archive/2009/05/21/poco-in-the-entity-framework-part-1-the-experience.aspx</a>, and use the MySql .Net Connector, and then just edit the table names on the designer surface. In that way I don&rsquo;t really care what MySql is doing with the table names, and everything is presented to me in code the way I&rsquo;d prefer to see it. So as illustrated by the <a href="http://blogs.msdn.com/b/adonet/archive/2009/05/21/poco-in-the-entity-framework-part-1-the-experience.aspx">POCO</a> article I&rsquo;d end up with code like this here.</p>

<div class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="k">public</span> <span class="k">class</span> <span class="nc">FreedomContext</span> <span class="p">:</span> <span class="n">ObjectContext</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="n">ObjectSet</span><span class="p">&lt;</span><span class="n">User</span><span class="p">&gt;</span> <span class="n">Users</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="n">ObjectSet</span><span class="p">&lt;</span><span class="n">Calendar</span><span class="p">&gt;</span> <span class="n">Calendars</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="n">ObjectSet</span><span class="p">&lt;</span><span class="n">Task</span><span class="p">&gt;</span> <span class="n">Tasks</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
 
    <span class="k">public</span> <span class="nf">FreedomContext</span><span class="p">()</span> <span class="p">:</span> <span class="k">base</span><span class="p">(</span><span class="s">&quot;name=freedomEntities&quot;</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">Users</span> <span class="p">=</span> <span class="n">CreateObjectSet</span><span class="p">&lt;</span><span class="n">User</span><span class="p">&gt;();</span>
        <span class="n">Calendars</span> <span class="p">=</span> <span class="n">CreateObjectSet</span><span class="p">&lt;</span><span class="n">Calendar</span><span class="p">&gt;();</span>
        <span class="n">Tasks</span> <span class="p">=</span> <span class="n">CreateObjectSet</span><span class="p">&lt;</span><span class="n">Task</span><span class="p">&gt;();</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></div>


<p>In this way I have avoided some of the issues, and still appear to have a workable solution. What this gains me is that I&rsquo;m not losing the data because I&rsquo;m making these changes to the database first, and then updating my Entity Framework model from there. I guess <strong>hate</strong> is a strong word to describe my feelings towards MySql. I do understand they have a unique problem because they are capable of running on multiple platforms, not just Microsoft Windows, so there are inherent challenges in that. And, now that I&rsquo;ve done some testing, the solution might be workable after all.</p>

<p><strong>At the end of the day I hate SQL the most</strong>. And I&rsquo;m sure that most of you do as well. Nobody wants to spend any more time than absolutely necessary writing scripts to create tables, add data, stored procedures, figuring out what relationships go where, and so on. That is one of the things that I really do like about the code first approach. If you follow a few conventions in your code, all of these relationships are interpolated for you, which is pretty damn awesome. I think there are still some short comings to code first, although you can get a lot accomplished very quickly, and I would certainly recommend it for small projects where speed out the door is of high importance. In fact, it&rsquo;s probably best suited at this point for prototyping of systems. Personally I would caution against the use of it for production systems, especially if you don&rsquo;t understand all of what is going on, because you are liable to get yourself into some trouble. I&rsquo;ve been testing things here and there as I&rsquo;ve been writing this, and at this point I think I&rsquo;ll continue to roll with Entity Framework POCO for this particular project, with source code following soon.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2011/04/25/aspnet-radiobuttongroupfor-extension/">ASP.Net RadioButtonGroupFor() Extension</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2011-04-25T00:00:00-04:00'><span class='date'><span class='date-month'>Apr</span> <span class='date-day'>25</span><span class='date-suffix'>th</span>, <span class='date-year'>2011</span></span> <span class='time'>12:00 am</span></time>
        
        
      </p>
    
  </header>


  <div class="entry-content"><p>The other day I wanted to create a group of radio buttons that corresponded to values in an Enum, and there wasn&rsquo;t anything already provided in the framework for doing so, or at least not that I am as of yet aware of. Given that MVC is so extensible though, I was able to hack something together very quickly.</p>

<p>The code below is the extension method itself.</p>

<div class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="k">public</span> <span class="k">static</span> <span class="n">MvcHtmlString</span> <span class="n">RadioButtonGroupFor</span><span class="p">&lt;</span><span class="n">TModel</span><span class="p">,</span> <span class="n">TValue</span><span class="p">&gt;(</span><span class="k">this</span> <span class="n">HtmlHelper</span><span class="p">&lt;</span><span class="n">TModel</span><span class="p">&gt;</span> <span class="n">helper</span><span class="p">,</span> <span class="n">Expression</span><span class="p">&lt;</span><span class="n">Func</span><span class="p">&lt;</span><span class="n">TModel</span><span class="p">,</span> <span class="n">TValue</span><span class="p">&gt;&gt;</span> <span class="n">expression</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">ModelMetadata</span> <span class="n">metaData</span> <span class="p">=</span> <span class="n">ModelMetadata</span><span class="p">.</span><span class="n">FromLambdaExpression</span><span class="p">(</span><span class="n">expression</span><span class="p">,</span> <span class="n">helper</span><span class="p">.</span><span class="n">ViewData</span><span class="p">);</span>
    <span class="kt">var</span> <span class="n">names</span> <span class="p">=</span> <span class="n">Enum</span><span class="p">.</span><span class="n">GetNames</span><span class="p">(</span><span class="n">metaData</span><span class="p">.</span><span class="n">ModelType</span><span class="p">);</span>
    <span class="n">System</span><span class="p">.</span><span class="n">IO</span><span class="p">.</span><span class="n">StringWriter</span> <span class="n">textWriter</span> <span class="p">=</span> <span class="k">new</span> <span class="n">System</span><span class="p">.</span><span class="n">IO</span><span class="p">.</span><span class="n">StringWriter</span><span class="p">();</span>
 
    <span class="k">using</span> <span class="p">(</span><span class="n">System</span><span class="p">.</span><span class="n">Web</span><span class="p">.</span><span class="n">UI</span><span class="p">.</span><span class="n">HtmlTextWriter</span> <span class="n">writer</span> <span class="p">=</span> <span class="k">new</span> <span class="n">System</span><span class="p">.</span><span class="n">Web</span><span class="p">.</span><span class="n">UI</span><span class="p">.</span><span class="n">HtmlTextWriter</span><span class="p">(</span><span class="n">textWriter</span><span class="p">))</span> 
    <span class="p">{</span>
        <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">item</span> <span class="k">in</span> <span class="n">Enum</span><span class="p">.</span><span class="n">GetValues</span><span class="p">(</span><span class="n">metaData</span><span class="p">.</span><span class="n">ModelType</span><span class="p">))</span> 
        <span class="p">{</span>
            <span class="kt">string</span> <span class="n">enumName</span> <span class="p">=</span> <span class="n">Enum</span><span class="p">.</span><span class="n">GetName</span><span class="p">(</span><span class="n">metaData</span><span class="p">.</span><span class="n">ModelType</span><span class="p">,</span> <span class="n">item</span><span class="p">);</span>
            
            <span class="k">if</span> <span class="p">(</span><span class="n">metaData</span><span class="p">.</span><span class="n">Model</span> <span class="p">==</span> <span class="n">item</span><span class="p">)</span> 
            <span class="p">{</span>
                <span class="n">writer</span><span class="p">.</span><span class="n">AddAttribute</span><span class="p">(</span><span class="n">HtmlTextWriterAttribute</span><span class="p">.</span><span class="n">Checked</span><span class="p">,</span> <span class="s">&quot;checked&quot;</span><span class="p">);</span>
            <span class="p">}</span>
            
            <span class="n">writer</span><span class="p">.</span><span class="n">AddAttribute</span><span class="p">(</span><span class="s">&quot;enum-name&quot;</span><span class="p">,</span> <span class="n">enumName</span><span class="p">);</span>
            <span class="n">writer</span><span class="p">.</span><span class="n">AddAttribute</span><span class="p">(</span><span class="n">HtmlTextWriterAttribute</span><span class="p">.</span><span class="n">Name</span><span class="p">,</span> <span class="n">metaData</span><span class="p">.</span><span class="n">PropertyName</span><span class="p">);</span>
            <span class="n">writer</span><span class="p">.</span><span class="n">AddAttribute</span><span class="p">(</span><span class="n">HtmlTextWriterAttribute</span><span class="p">.</span><span class="n">Value</span><span class="p">,</span> <span class="n">Convert</span><span class="p">.</span><span class="n">ToInt32</span><span class="p">(</span><span class="n">item</span><span class="p">).</span><span class="n">ToString</span><span class="p">());</span>
            <span class="n">writer</span><span class="p">.</span><span class="n">AddAttribute</span><span class="p">(</span><span class="n">HtmlTextWriterAttribute</span><span class="p">.</span><span class="n">Type</span><span class="p">,</span> <span class="s">&quot;radio&quot;</span><span class="p">);</span>
            <span class="n">writer</span><span class="p">.</span><span class="n">RenderBeginTag</span><span class="p">(</span><span class="n">HtmlTextWriterTag</span><span class="p">.</span><span class="n">Input</span><span class="p">);</span>
            <span class="n">writer</span><span class="p">.</span><span class="n">RenderEndTag</span><span class="p">();</span>
            <span class="n">writer</span><span class="p">.</span><span class="n">Write</span><span class="p">(</span><span class="n">enumName</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
 
    <span class="k">return</span> <span class="n">MvcHtmlString</span><span class="p">.</span><span class="n">Create</span><span class="p">(</span><span class="n">textWriter</span><span class="p">.</span><span class="n">ToString</span><span class="p">());</span>
<span class="p">}</span></code></pre></div>


<p>And the markup below is a simple use case.</p>

<div class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;p&gt;</span>
  <span class="nt">&lt;label&gt;</span>Type:<span class="nt">&lt;/label&gt;</span>
  @Html.RadioButtonGroupFor(m =&gt; m.AccountType)
<span class="nt">&lt;/p&gt;</span></code></pre></div>


<p>Now provided your Model has a property on it of a type for your Enum, then all of those possible values will be written out to the screen, and of course the current value for the object, if there is one, will be selected.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2011/04/18/sort-order-for-list-with-persistence/">Sort Order for List With Persistence</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2011-04-18T00:00:00-04:00'><span class='date'><span class='date-month'>Apr</span> <span class='date-day'>18</span><span class='date-suffix'>th</span>, <span class='date-year'>2011</span></span> <span class='time'>12:00 am</span></time>
        
        
      </p>
    
  </header>


  <div class="entry-content"><blockquote><p>It was brought to my attention that my post wasn&rsquo;t all that informative because it didn&rsquo;t the UI code to go along with this, so I have updated the post to include that information.</p></blockquote>

<p>Something that seems to come up often enough, although not all that recently for myself, is to control the display order for items when presenting them in the user interface. This requirement of course is then paired with another requirement, the content manager needs a means of changing the sort order or items via some administrative tool. I had to do this today, so this will either serve as a reference, or possibly open myself up for criticism, but either way, here it is.</p>

<div class="highlight"><pre><code class="language-vbnet" data-lang="vbnet"><span class="k">Dim</span> <span class="n">originalOrder</span> <span class="o">=</span> <span class="n">MyService</span><span class="p">.</span><span class="n">GetItem</span><span class="p">(</span><span class="n">itemId</span><span class="p">).</span><span class="n">SortOrder</span>
<span class="k">Dim</span> <span class="n">lowerBounds</span> <span class="ow">As</span> <span class="kt">Integer</span>
<span class="k">Dim</span> <span class="n">upperBounds</span> <span class="ow">As</span> <span class="kt">Integer</span>
<span class="k">Dim</span> <span class="n">isDecrement</span> <span class="ow">As</span> <span class="kt">Boolean</span> <span class="o">=</span> <span class="k">False</span>
 
<span class="k">If</span> <span class="n">originalOrder</span> <span class="o">&gt;</span> <span class="n">sortOrder</span> <span class="k">Then</span>
    <span class="n">lowerBounds</span> <span class="o">=</span> <span class="n">sortOrder</span>
    <span class="n">upperBounds</span> <span class="o">=</span> <span class="n">originalOrder</span>
<span class="k">Else</span>
    <span class="n">lowerBounds</span> <span class="o">=</span> <span class="n">originalOrder</span>
    <span class="n">upperBounds</span> <span class="o">=</span> <span class="n">sortOrder</span>
    <span class="n">isDecrement</span> <span class="o">=</span> <span class="k">True</span>
<span class="k">End</span> <span class="k">If</span>
 
<span class="k">For</span> <span class="k">Each</span> <span class="n">item</span> <span class="ow">In</span> <span class="n">MyService</span><span class="p">.</span><span class="n">GetAllItems</span><span class="p">.</span><span class="n">Where</span><span class="p">(</span><span class="n">Function</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="n">m</span><span class="p">.</span><span class="n">SortOrder</span> <span class="o">&lt;=</span> <span class="n">upperBounds</span> <span class="ow">And</span> <span class="n">m</span><span class="p">.</span><span class="n">SortOrder</span> <span class="o">&gt;=</span> <span class="n">lowerBounds</span><span class="p">).</span><span class="n">OrderBy</span><span class="p">(</span><span class="n">Function</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="n">m</span><span class="p">.</span><span class="n">SortOrder</span><span class="p">)</span>
    <span class="k">If</span> <span class="n">item</span><span class="p">.</span><span class="n">ID</span> <span class="o">=</span> <span class="n">itemId</span> <span class="k">Then</span>
        <span class="n">item</span><span class="p">.</span><span class="n">SortOrder</span> <span class="o">=</span> <span class="n">sortOrder</span>
    <span class="k">Else</span>
        <span class="n">item</span><span class="p">.</span><span class="n">SortOrder</span> <span class="o">=</span> <span class="n">IIf</span><span class="p">(</span><span class="n">isDecrement</span><span class="p">,</span> <span class="n">item</span><span class="p">.</span><span class="n">SortOrder</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">item</span><span class="p">.</span><span class="n">SortOrder</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">End</span> <span class="k">If</span>
 
    <span class="n">item</span><span class="p">.</span><span class="n">Update</span><span class="p">()</span>
<span class="k">Next</span></code></pre></div>


<p>If anyone knows if a more simplistic, or perhaps just better, means of accomplishing this please feel free to comment (not that I&rsquo;ve received comments from anyone to date, still working on that). The approach here is to update only that which requires updating, rather than iterate back over the entire list.</p>

<p>On the presentation end of this I simply have an HTML table and a bit of javascript that makes use of jQuery UI&rsquo;s .sortable(). The code below is what accomplishes this, which I will explain.</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#myTable tbody&#39;</span><span class="p">).</span><span class="nx">sortable</span><span class="p">({</span>
  <span class="nx">update</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">,</span> <span class="nx">ui</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">$tr</span><span class="p">;</span> 
      <span class="k">if</span> <span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">toElement</span><span class="p">.</span><span class="nx">tagName</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;td&quot;</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">$tr</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">toElement</span><span class="p">.</span><span class="nx">parentElement</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">else</span> <span class="p">{</span>
        <span class="nx">$tr</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">toElement</span><span class="p">;</span>
      <span class="p">}</span>
 
      <span class="kd">var</span> <span class="nx">rowId</span> <span class="o">=</span> <span class="nx">getRowIndex</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#myTable&#39;</span><span class="p">),</span> <span class="nx">$tr</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
      <span class="kd">var</span> <span class="nx">itemId</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="nx">$tr</span><span class="p">).</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;td&#39;</span><span class="p">).</span><span class="nx">eq</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="nx">html</span><span class="p">());</span>
 
      <span class="k">if</span> <span class="p">(</span><span class="nx">itemId</span> <span class="o">&amp;&amp;</span> <span class="nx">rowId</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
          <span class="nx">url</span><span class="o">:</span> <span class="s1">&#39;/myStuff/updatesortorder&#39;</span><span class="p">,</span>
          <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;post&#39;</span><span class="p">,</span>
          <span class="nx">data</span><span class="o">:</span> <span class="p">{</span>
            <span class="nx">itemId</span><span class="o">:</span> <span class="nx">itemId</span><span class="p">,</span>
            <span class="nx">sortOrder</span><span class="o">:</span> <span class="nx">rowId</span>
          <span class="p">}</span>
        <span class="p">});</span>
      <span class="p">}</span>
  <span class="p">},</span>
  <span class="nx">cursor</span><span class="o">:</span> <span class="s1">&#39;pointer&#39;</span>
<span class="p">});</span></code></pre></div>


<p>For the most part this is really straight forward, but there are two things I want to point out. First, jQuery .sortable() will return the targetElement as a <code>&lt;tr /&gt;</code>, or sometimes a <code>&lt;td /&gt;</code> and this all depends on where on the row you clicked to drag. For that reason the first few lines of code are responsible for specifically getting the <code>&lt;tr /&gt;</code> so we can then find out where it was dragged to. Then there is also a call to a helper function called .getRowIndex(). This helper is responsible for performing the comparison and returning the index of the <code>&lt;tr /&gt;</code>&rsquo;s new position in the table. With that information we can then increment that index value by 1, since it is 0 based, and then we can call whatever service to perform the update.</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">function</span> <span class="nx">getRowIndex</span><span class="p">(</span><span class="nx">table</span><span class="p">,</span> <span class="nx">target</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
 
  <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;tbody tr&#39;</span><span class="p">,</span> <span class="nx">table</span><span class="p">).</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">index</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span> <span class="o">==</span> <span class="nx">target</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">result</span> <span class="o">=</span> <span class="nx">index</span><span class="p">;</span>
      <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">});</span>
 
  <span class="k">return</span> <span class="nx">result</span><span class="p">;</span>
<span class="p">}</span></code></pre></div>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2011/04/08/unobtrusive-validation-issue-with-mvc-3/">Unobtrusive Validation Issue With MVC 3</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2011-04-08T00:00:00-04:00'><span class='date'><span class='date-month'>Apr</span> <span class='date-day'>8</span><span class='date-suffix'>th</span>, <span class='date-year'>2011</span></span> <span class='time'>12:00 am</span></time>
        
        
      </p>
    
  </header>


  <div class="entry-content"><p>I&rsquo;ve been using data annotations in conjunction with unobtrusive validation lately and really loving it. The other day I ran into a problem with it though, so I&rsquo;ll give you a quick work around in case you run into it yourselves. What I wanted to do was manually specify validation rules using $(element).validate(), since I didn&rsquo;t have an actual object I&rsquo;d be binding to. I could have just created the model, specified the annotations, and I would have been good to go, but this site I was working on has these manual validations specified all over the place, so taking the &ldquo;easy&rdquo; way out wasn&rsquo;t an option. So here is what I did.</p>

<p>The problem is with the way Microsoft&rsquo;s validation library works on the client side, if you have the .js files to support this linked in via your master page, as well you probably should, they don&rsquo;t care that for a particular form you haven&rsquo;t enabled client validation using unobtrusive javascript, but instead it tries to wire itself up to every form it finds.</p>

<p>The solution was to modify the &ldquo;parse&rdquo; function of the jquery.validate.unobtrusive.js file, and add the line below as the first call. With this call in place, if you have forms you want to handle validation manually, you can just add a class of &ldquo;ms-ignore&rdquo; to them, and then everything will work as it used to.</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="k">if</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">hasClass</span><span class="p">(</span><span class="s1">&#39;ms-ignore&#39;</span><span class="p">))</span> <span class="p">{</span> <span class="k">return</span><span class="p">;</span> <span class="p">}</span></code></pre></div>


<p>The solution feels a little &ldquo;hacky&rdquo; to me, but I feel that way most of the time I&rsquo;m working with some of the newer Microsoft technologies. I&rsquo;m a huge fan of MVC, and I love the data annotation validations, but even the MVC 2 bolt ons required work arounds to get the correct behavior.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2011/01/12/aspnet-mvc-2-client-side-validation/">ASP.Net MVC 2 Client-Side Validation With jQuery Error</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2011-01-12T00:00:00-05:00'><span class='date'><span class='date-month'>Jan</span> <span class='date-day'>12</span><span class='date-suffix'>th</span>, <span class='date-year'>2011</span></span> <span class='time'>12:00 am</span></time>
        
        
      </p>
    
  </header>


  <div class="entry-content"><p>For anybody that finds themselves unsure as to why the hell the Html.ValidationSummary() does not render out the client-side errors when using JQuery to do this, you&rsquo;ll have to look at the MicrosoftMvcJQueryValidation.js file and what you&rsquo;ll find at the bottom is a function for <code>__MVC_EnableClientValidation</code>, which is simply wrong.</p>

<p>The code below doesn&rsquo;t allow you to turn on and off the use of a validation summary control, but does physically allow it, and will only use it. Hopefully I&rsquo;ll get to edit this post some other time, but in the meantime, you can use this as a starting point.</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">function</span> <span class="nx">__MVC_EnableClientValidation</span><span class="p">(</span><span class="nx">validationContext</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// this represents the form containing elements to be validated</span>
    <span class="kd">var</span> <span class="nx">theForm</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#&quot;</span> <span class="o">+</span> <span class="nx">validationContext</span><span class="p">.</span><span class="nx">FormId</span><span class="p">);</span>
 
    <span class="kd">var</span> <span class="nx">fields</span> <span class="o">=</span> <span class="nx">validationContext</span><span class="p">.</span><span class="nx">Fields</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">rulesObj</span> <span class="o">=</span> <span class="nx">__MVC_CreateValidationOptions</span><span class="p">(</span><span class="nx">fields</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">fieldToMessageMappings</span> <span class="o">=</span> <span class="nx">__MVC_CreateFieldToValidationMessageMapping</span><span class="p">(</span><span class="nx">fields</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">errorMessagesObj</span> <span class="o">=</span> <span class="nx">__MVC_CreateErrorMessagesObject</span><span class="p">(</span><span class="nx">fields</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">errorContainer</span> <span class="o">=</span> <span class="s1">&#39;#&#39;</span> <span class="o">+</span> <span class="nx">validationContext</span><span class="p">.</span><span class="nx">ValidationSummaryId</span><span class="p">;</span>
 
    <span class="kd">var</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{</span>
        <span class="nx">errorContainer</span><span class="o">:</span> <span class="nx">errorContainer</span><span class="p">,</span>
        <span class="nx">errorLabelContainer</span><span class="o">:</span> <span class="nx">errorContainer</span> <span class="o">+</span> <span class="s1">&#39; ul&#39;</span><span class="p">,</span>
        <span class="nx">wrapper</span><span class="o">:</span> <span class="s1">&#39;li&#39;</span><span class="p">,</span>
        <span class="nx">messages</span><span class="o">:</span> <span class="nx">errorMessagesObj</span><span class="p">,</span>
        <span class="nx">rules</span><span class="o">:</span> <span class="nx">rulesObj</span>
    <span class="p">};</span>
 
    <span class="c1">// register callbacks with our AJAX system</span>
    <span class="kd">var</span> <span class="nx">formElement</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="nx">validationContext</span><span class="p">.</span><span class="nx">FormId</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">registeredValidatorCallbacks</span> <span class="o">=</span> <span class="nx">formElement</span><span class="p">.</span><span class="nx">validationCallbacks</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">registeredValidatorCallbacks</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">registeredValidatorCallbacks</span> <span class="o">=</span> <span class="p">[];</span>
        <span class="nx">formElement</span><span class="p">.</span><span class="nx">validationCallbacks</span> <span class="o">=</span> <span class="nx">registeredValidatorCallbacks</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nx">registeredValidatorCallbacks</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">theForm</span><span class="p">.</span><span class="nx">validate</span><span class="p">();</span>
        <span class="k">return</span> <span class="nx">theForm</span><span class="p">.</span><span class="nx">valid</span><span class="p">();</span>
    <span class="p">});</span>
 
    <span class="nx">theForm</span><span class="p">.</span><span class="nx">validate</span><span class="p">(</span><span class="nx">options</span><span class="p">);</span>
<span class="p">}</span></code></pre></div>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2010/05/10/jquery-ui-validation-summary/">jQuery UI Validation Summary</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2010-05-10T00:00:00-04:00'><span class='date'><span class='date-month'>May</span> <span class='date-day'>10</span><span class='date-suffix'>th</span>, <span class='date-year'>2010</span></span> <span class='time'>12:00 am</span></time>
        
        
      </p>
    
  </header>


  <div class="entry-content"><p>Today I was exploring the ability to return model errors back to the view, and had wanted to replace the standard validation summary panel with a jQuery UI error message widget. Below is an extension method that allows you to do this very easily.</p>

<div class="highlight"><pre><code class="language-vbnet" data-lang="vbnet"><span class="k">Public</span> <span class="k">Function</span> <span class="nf">PrettyValidationSummary</span><span class="p">(</span><span class="k">ByVal</span> <span class="n">helper</span> <span class="ow">As</span> <span class="n">HtmlHelper</span><span class="p">)</span> <span class="ow">As</span> <span class="kt">String</span>
 
    <span class="k">Dim</span> <span class="n">template</span> <span class="ow">As</span> <span class="kt">String</span> <span class="o">=</span> <span class="s">&quot;&lt;div class=&quot;</span><span class="n">ui</span><span class="o">-</span><span class="n">widget</span><span class="s">&quot;&gt;&lt;div class=&quot;</span><span class="n">ui</span><span class="o">-</span><span class="n">state</span><span class="o">-</span><span class="k">error</span> <span class="n">ui</span><span class="o">-</span><span class="n">corner</span><span class="o">-</span><span class="n">all</span><span class="s">&quot; style=&quot;</span><span class="n">padding</span><span class="p">:</span><span class="mi">0</span> <span class="p">.</span><span class="mi">7</span><span class="n">em</span><span class="s">&quot;&gt;&lt;div&gt;&lt;span class=&quot;</span><span class="n">ui</span><span class="o">-</span><span class="n">icon</span> <span class="n">ui</span><span class="o">-</span><span class="n">icon</span><span class="o">-</span><span class="n">alert</span><span class="s">&quot; style=&quot;</span><span class="n">float</span><span class="p">:</span> <span class="n">left</span><span class="err">;</span> <span class="n">margin</span><span class="o">-</span><span class="n">right</span><span class="p">:</span> <span class="p">.</span><span class="mi">3</span><span class="n">em</span><span class="err">;</span><span class="s">&quot;&gt;&lt;/span&gt;&lt;strong&gt;Validation Exceptions:&lt;/strong&gt;&lt;/div&gt;&lt;div style=&quot;</span><span class="n">margin</span><span class="o">-</span><span class="n">top</span><span class="p">:</span> <span class="mi">5</span><span class="n">px</span><span class="err">;</span><span class="s">&quot;&gt;&lt;ul style=&quot;</span><span class="n">font</span><span class="o">-</span><span class="n">weight</span><span class="p">:</span> <span class="n">normal</span><span class="err">;</span><span class="s">&quot;&gt;{0}&lt;/ul&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&quot;</span>
    <span class="k">Dim</span> <span class="n">exceptionList</span> <span class="ow">As</span> <span class="k">New</span> <span class="n">StringBuilder</span>
 
    <span class="c">&#39; Iterate through the exceptions.</span>
    <span class="k">For</span> <span class="k">Each</span> <span class="n">m</span> <span class="ow">In</span> <span class="n">helper</span><span class="p">.</span><span class="n">ViewData</span><span class="p">.</span><span class="n">ModelState</span>
        <span class="k">For</span> <span class="k">Each</span> <span class="n">e</span> <span class="ow">In</span> <span class="n">m</span><span class="p">.</span><span class="n">Value</span><span class="p">.</span><span class="n">Errors</span>
            <span class="n">exceptionList</span><span class="p">.</span><span class="n">Append</span><span class="p">(</span><span class="kt">String</span><span class="p">.</span><span class="n">Format</span><span class="p">(</span><span class="s">&quot;&lt;li&gt;{0}&lt;/li&gt;&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">.</span><span class="n">ErrorMessage</span><span class="p">))</span>
        <span class="k">Next</span>
    <span class="k">Next</span>
 
    <span class="c">&#39; Make sure we have exceptions before we do anything.</span>
    <span class="k">If</span> <span class="n">exceptionList</span><span class="p">.</span><span class="n">Length</span><span class="p">.</span><span class="n">Equals</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="k">Then</span>
        <span class="k">Return</span> <span class="kt">String</span><span class="p">.</span><span class="n">Empty</span>
    <span class="k">Else</span>
        <span class="k">Return</span> <span class="kt">String</span><span class="p">.</span><span class="n">Format</span><span class="p">(</span><span class="n">template</span><span class="p">,</span> <span class="n">exceptionList</span><span class="p">.</span><span class="n">ToString</span><span class="p">())</span>
    <span class="k">End</span> <span class="k">If</span>
<span class="k">End</span> <span class="k">Function</span></code></pre></div>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2010/03/23/aspnet-mvc-update-multiple-records-at/">ASP.Net MVC - Update Multiple Records at Once</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2010-03-23T00:00:00-04:00'><span class='date'><span class='date-month'>Mar</span> <span class='date-day'>23</span><span class='date-suffix'>rd</span>, <span class='date-year'>2010</span></span> <span class='time'>12:00 am</span></time>
        
        
      </p>
    
  </header>


  <div class="entry-content"><p>I had a need to update multiple records in one view, and as always a quick google search brought me to the following two articles:</p>

<ul>
<li><a href="http://haacked.com/archive/2008/10/23/model-binding-to-a-list.aspx">http://haacked.com/archive/2008/10/23/model-binding-to-a-list.aspx</a></li>
<li><a href="http://weblogs.asp.net/bhaskarghosh/archive/2009/06/18/7128803.aspx">http://weblogs.asp.net/bhaskarghosh/archive/2009/06/18/7128803.aspx</a></li>
</ul>


<p>I was going to include some snippets of code from my implementation, but Blogger doesn&rsquo;t seem to like me putting form elements on my blog the way I have it configured presently, so instead here is a quick list of notes.</p>

<ul>
<li>It is not a typo that the input elements are missing an id and instead are using the name attribute as it will not work otherwise.</li>
<li>The prefix of the element name, which in my test case was &ldquo;golfCourses&rdquo;, must match the parameter name of the method you are using to handle the post.</li>
<li>A generic list does work as a parameter type.</li>
<li>The last thing is that even though other posts would lead you to believe that your would be array indexes in your html input element names can be whatever you want, I have found in my own testing that it does not work as desired unless this is 0 based, meaning your first element must start with 0, and each additional group of elements that define the next object should increment by 1.</li>
</ul>


<p>Other than that, things really are as simple as they seem. So who needs data grids?</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2010/03/21/aspnet-mvc-delete-confirmation/">ASP.Net MVC - Delete Confirmation</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2010-03-21T00:00:00-04:00'><span class='date'><span class='date-month'>Mar</span> <span class='date-day'>21</span><span class='date-suffix'>st</span>, <span class='date-year'>2010</span></span> <span class='time'>12:00 am</span></time>
        
        
      </p>
    
  </header>


  <div class="entry-content"><p>I&rsquo;ve not been able to find a real comprehensive article or blog post anywhere that details how to use a jquery dialog to confirm you want to delete a record, so this will be a quick run through on what I ended up doing.</p>

<p>First, the code for the link looks like this.</p>

<div class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;javascript:void(0)&quot;</span> <span class="na">onclick=</span><span class="s">&quot;doDelete(&lt;%= item.Id %&gt;)&quot;</span><span class="nt">&gt;</span>Delete<span class="nt">&lt;/a&gt;</span></code></pre></div>


<p>The javascript that this link calls looks like the following.</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">function</span> <span class="nx">doDelete</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#golfCourseDeleteView&#39;</span><span class="p">).</span><span class="nx">dialog</span><span class="p">({</span>
        <span class="nx">autoOpen</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
        <span class="nx">modal</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
        <span class="nx">buttons</span><span class="o">:</span> <span class="p">{</span>
            <span class="nx">Yes</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
                    <span class="nx">url</span><span class="o">:</span> <span class="s2">&quot;/GolfCourses/Delete&quot;</span><span class="p">,</span>
                    <span class="nx">data</span><span class="o">:</span> <span class="p">{</span> <span class="nx">id</span><span class="o">:</span> <span class="nx">id</span> <span class="p">},</span>
                    <span class="nx">type</span><span class="o">:</span> <span class="s2">&quot;post&quot;</span><span class="p">,</span>
                    <span class="nx">success</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">reload</span><span class="p">();</span> <span class="p">}</span>
                <span class="p">});</span>
            <span class="p">},</span>
            <span class="nx">No</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">dialog</span><span class="p">(</span><span class="s1">&#39;close&#39;</span><span class="p">);</span> <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">});</span>
<span class="p">}</span></code></pre></div>


<p>An extension to this would be to have the contoller action return some sort of success or failure indication and determine if the redirect should be performed based on that, but maybe more on that later.</p>

<p>The only aspect of this I wish I could change is the need to do window.location.reload() on success for the ajax call. For now I guess it should be enough that we have a dialog displaying rather than directing our users to another page, which means if they didn&rsquo;t mean to delete anything, we saved ourselves the time of rendering the delete view and then reloading index.</p>

<p>I hope this helps someone out.</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/posts/4">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    
  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2015 - Brad Teller -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a> | Themed with <a href="https://github.com/lucaslew/whitespace">Whitespace</a></span>
</p>

</footer>
  






<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
