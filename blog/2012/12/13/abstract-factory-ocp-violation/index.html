
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Abstract Factory: A Violation of the Open Closed Principle? - Brad Teller</title>
  <meta name="author" content="Brad Teller">

  
  <meta name="description" content="This is either a tough one, or I&rsquo;m really overcomplicating things. I&rsquo;m pretty sure though that I&rsquo;m in one of those impossible &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://bradteller.com/blog/2012/12/13/abstract-factory-ocp-violation/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Brad Teller" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Brad Teller</a></h1>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="sitesearch" value="bradteller.com">
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Abstract Factory: A Violation of the Open Closed Principle?</h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2012-12-13T00:00:00-05:00'><span class='date'><span class='date-month'>Dec</span> <span class='date-day'>13</span><span class='date-suffix'>th</span>, <span class='date-year'>2012</span></span> <span class='time'>12:00 am</span></time>
        
      </p>
    
  </header>


<div class="entry-content"><p>This is either a tough one, or I&rsquo;m really overcomplicating things. I&rsquo;m pretty sure though that I&rsquo;m in one of those impossible situations where there really is no right answer. You try, and try, and you just can&rsquo;t please everyone. Anyway, here is my dilema.</p>

<h2>The Game</h2>

<p>I&rsquo;m building this game (Okay! Not really but it serves as a good example) and I want to give players the ability to buy weapons from a sleezy armory worker that sells goods out the back door. Imagine if you will that the player sees an interface like this one.</p>

<p><img src="/assets/images/posts/absfacocp.PNG" alt="Game Interface" style="display: block; margin: 0 auto;" /></p>

<p>That is all well and good. They just go ahead and select the weapon they have enough money to purchase and click the buy button. The issue is what this means for the code.</p>

<h2>The Code</h2>

<p>I&rsquo;m feeling pretty good about it so far. Since players can outfit themselves with any number of weapons, I&rsquo;ve got an abstract class that each of the weapon classes will inherit.</p>

<div class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="k">public</span> <span class="k">abstract</span> <span class="k">class</span> <span class="nc">Weapon</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="kt">int</span> <span class="n">HitPower</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">protected</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">int</span> <span class="n">WaitTime</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">protected</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

    <span class="k">public</span> <span class="k">void</span> <span class="nf">Strike</span><span class="p">(</span><span class="n">IOpponent</span> <span class="n">opponent</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">opponent</span><span class="p">.</span><span class="n">GetHitBy</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></div>


<p>Then we&rsquo;ve got individual classes for each of the weapon types. The idea here being that each type of weapon will have some limitations, as well as differing strengths.</p>

<div class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="k">public</span> <span class="k">class</span> <span class="nc">Sword</span> <span class="p">:</span> <span class="n">Weapon</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="nf">Sword</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="n">HitPower</span> <span class="p">=</span> <span class="m">10</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="n">WaitTime</span> <span class="p">=</span> <span class="m">4</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">public</span> <span class="k">class</span> <span class="nc">BeerBottle</span> <span class="p">:</span> <span class="n">Weapon</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="nf">BeerBottle</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="n">HitPower</span> <span class="p">=</span> <span class="m">2</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="n">WaitTime</span> <span class="p">=</span> <span class="m">1</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></div>


<p>Then to outfit a player with a weapon I&rsquo;ve got an abstract factory to create new instances of the weapons.</p>

<div class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="k">public</span> <span class="k">class</span> <span class="nc">WeaponFactory</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">static</span> <span class="n">Weapon</span> <span class="nf">CreateWeapon</span><span class="p">(</span><span class="kt">string</span> <span class="n">weaponName</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">switch</span> <span class="p">(</span><span class="n">weaponName</span><span class="p">.</span><span class="n">ToLower</span><span class="p">())</span>
        <span class="p">{</span>
            <span class="k">case</span> <span class="s">&quot;sword&quot;</span><span class="p">:</span>
                <span class="k">return</span> <span class="k">new</span> <span class="nf">Sword</span><span class="p">();</span>
            <span class="k">case</span> <span class="s">&quot;beerbottle&quot;</span><span class="p">:</span>
                <span class="k">return</span> <span class="k">new</span> <span class="nf">BeerBottle</span><span class="p">();</span>
            <span class="k">default</span><span class="p">:</span>
                <span class="k">throw</span> <span class="k">new</span> <span class="nf">NotImplementedException</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></div>


<p>Not bad, right? Perhaps not&hellip;</p>

<h2>The Issue</h2>

<p>The problem I have with this is that it would seem to violate the open closed principle. If I want to add another weapon into the system I&rsquo;m fine, all the way up until I want to be able to create instances of these weapons. So if I wanted to add a knife as a weapon I&rsquo;d have to modify the abstract factory so it can create instances of the knife class, like so.</p>

<div class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="k">public</span> <span class="k">class</span> <span class="nc">WeaponFactory</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">static</span> <span class="n">Weapon</span> <span class="nf">CreateWeapon</span><span class="p">(</span><span class="kt">string</span> <span class="n">weaponName</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">switch</span> <span class="p">(</span><span class="n">weaponName</span><span class="p">.</span><span class="n">ToLower</span><span class="p">())</span>
        <span class="p">{</span>
            <span class="k">case</span> <span class="s">&quot;sword&quot;</span><span class="p">:</span>
                <span class="k">return</span> <span class="k">new</span> <span class="nf">Sword</span><span class="p">();</span>
            <span class="k">case</span> <span class="s">&quot;beerbottle&quot;</span><span class="p">:</span>
                <span class="k">return</span> <span class="k">new</span> <span class="nf">BeerBottle</span><span class="p">();</span>
            <span class="k">case</span> <span class="s">&quot;sword&quot;</span><span class="p">:</span>
                <span class="k">return</span> <span class="k">new</span> <span class="nf">Sword</span><span class="p">();</span>
            <span class="k">default</span><span class="p">:</span>
                <span class="k">throw</span> <span class="k">new</span> <span class="nf">NotImplementedException</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></div>


<p>But to me that hardly seems like it is closed for modification. The only problem is, what the hell choice do I have?</p>

<h2>The Short of It</h2>

<p>Unless someone out there tells me differently, I think this code is about as good as it can be. I&rsquo;ve tried to find a way to make this code conform to the open closed principle and it just does not appear to be possible. Sure, I could create forms for each of the weapon types, but that doesn&rsquo;t improve the situation, just pushes it farther up the chain.</p>

<p>So it would appear that sometimes you just can&rsquo;t get to 100%. Sometimes close is all you can really hope for.</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Brad Teller</span></span>

      




<time class='entry-date' datetime='2012-12-13T00:00:00-05:00'><span class='date'><span class='date-month'>Dec</span> <span class='date-day'>13</span><span class='date-suffix'>th</span>, <span class='date-year'>2012</span></span> <span class='time'>12:00 am</span></time>
      


    </p>
    
      <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://bradteller.com/blog/2012/12/13/abstract-factory-ocp-violation/" data-via="bradteller" data-counturl="http://bradteller.com/blog/2012/12/13/abstract-factory-ocp-violation/" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium"></div>
  
  
    <div class="fb-like" data-send="true" data-width="450" data-show-faces="false"></div>
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2012/12/07/twitter-bootstrap-tags/" title="Previous Post: Twitter Bootstrap Tags">&laquo; Twitter Bootstrap Tags</a>
      
      
        <a class="basic-alignment right" href="/blog/2012/12/26/dont-fight-the-framework/" title="Next Post: Don't Fight the Framework">Don't Fight the Framework &raquo;</a>
      
    </p>
  </footer>
</article>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2015/07/01/responsive-now/">Start Planning for Responsive Design, NOW!</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/12/15/pdiff-the-right-way/">Perceptual Differencing, the Right Way!</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/07/02/tfs-build-getting-better/">TFS Build Might Be Getting Better</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/04/16/maybe-oneget-is-for/">Maybe I Know What OneGet Is For</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/04/11/what-is-oneget/">OneGet... What For?</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/bteller">@bteller</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'bteller',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>





  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2015 - Brad Teller -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
