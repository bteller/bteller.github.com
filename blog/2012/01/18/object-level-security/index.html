
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Object Level Security - Brad Teller</title>
  <meta name="author" content="Brad Teller">

  
  <meta name="description" content="A few weeks ago at work I had the need to provide object level security in a system. I looked around on the web and didn&rsquo;t really see anything &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://bradteller.com/blog/2012/01/18/object-level-security/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Brad Teller" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Brad Teller</a></h1>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="sitesearch" value="bradteller.com">
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Object Level Security</h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2012-01-18T00:00:00-05:00'><span class='date'><span class='date-month'>Jan</span> <span class='date-day'>18</span><span class='date-suffix'>th</span>, <span class='date-year'>2012</span></span> <span class='time'>12:00 am</span></time>
        
      </p>
    
  </header>


<div class="entry-content"><p>A few weeks ago at work I had the need to provide object level security in a system. I looked around on the web and didn&rsquo;t really see anything other than slight hints at possible solutions to the problem, but nothing really comprehensive. To that end I&rsquo;ve got the following few snippets of code that might help someone else looking to solve a similar problem. I&rsquo;m also going to upload the sample code here as well, but don&rsquo;t expect much more than what you see in the snippets below just yet, but I&rsquo;ll try and build out something more functional in the near future.</p>

<p>First we&rsquo;ll create a few objects. Really we only need two objects for the example to work, and then you can build on that for your own implementation. Let&rsquo;s first define a domain object we might work with in a project, Product.</p>

<div class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="k">class</span> <span class="nc">Product</span> <span class="p">{</span>
    <span class="k">public</span> <span class="kt">int</span> <span class="n">ProductId</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">Name</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span></code></pre></div>


<p>Not a very helpful object at this point from a business sense, but it will serve the purpose for our simple example. The other important one is the ObjectPermission object which looks something like this.</p>

<div class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="k">class</span> <span class="nc">ObjectPermission</span> <span class="p">{</span>
    <span class="k">public</span> <span class="kt">int</span> <span class="n">ObjectPermissionId</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">int</span> <span class="n">UserId</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="n">GrantType</span> <span class="n">GrantType</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="n">AccessType</span> <span class="n">AccessType</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">Object</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">LimitingField</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">LimitingValue</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span></code></pre></div>


<p>You can look at the example code attached to this post to see what GrantType and AccessType look like. The Object property is just your objects name, so in our example we&rsquo;ll make this &ldquo;Product&rdquo;. The other properties <strong>LimitingField</strong> and <strong>LimitingValue</strong> are there so you can say when a product has a name of x then allow or disallow access to the object. This comes in handy if you have different types of objects and you want a user to only have access to a subset of those.</p>

<p>The real work horse is this next class, the ObjectPermissionEnforcer. An intimidating name, right?</p>

<div class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="k">class</span> <span class="nc">ObjectPermissionEnforcer</span> <span class="p">{</span>
    <span class="k">private</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">ObjectPermission</span><span class="p">&gt;</span> <span class="n">_permissions</span><span class="p">;</span>

    <span class="k">public</span> <span class="nf">ObjectPermissionEnforcer</span><span class="p">()</span> <span class="p">{</span>
        <span class="kt">var</span> <span class="n">db</span> <span class="p">=</span> <span class="k">new</span> <span class="n">SampleContext</span><span class="p">();</span>
        <span class="n">_permissions</span> <span class="p">=</span> <span class="n">db</span><span class="p">.</span><span class="n">ObjectPermissions</span><span class="p">.</span><span class="n">ToList</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="nf">ObjectPermissionEnforcer</span><span class="p">(</span><span class="n">List</span><span class="p">&lt;</span><span class="n">ObjectPermission</span><span class="p">&gt;</span> <span class="n">perms</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">_permissions</span> <span class="p">=</span> <span class="n">perms</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;</span> <span class="n">SecureList</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;(</span><span class="n">List</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;</span> <span class="n">secure</span><span class="p">,</span> <span class="n">AccessType</span> <span class="n">accessType</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">var</span> <span class="n">result</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;();</span>

        <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">item</span> <span class="k">in</span> <span class="n">secure</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span><span class="p">(</span><span class="n">HasAccess</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">accessType</span><span class="p">))</span> <span class="p">{</span>
                <span class="n">result</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">item</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="n">result</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="kt">bool</span> <span class="nf">HasAccess</span><span class="p">(</span><span class="kt">object</span> <span class="n">o</span><span class="p">,</span> <span class="n">AccessType</span> <span class="n">accessType</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">_permissions</span><span class="p">.</span><span class="n">Where</span><span class="p">(</span><span class="n">p</span> <span class="p">=&gt;</span> <span class="n">p</span><span class="p">.</span><span class="n">Object</span><span class="p">.</span><span class="n">Equals</span><span class="p">(</span><span class="s">&quot;All&quot;</span><span class="p">)</span> <span class="p">&amp;&amp;</span> <span class="n">p</span><span class="p">.</span><span class="n">AccessType</span><span class="p">.</span><span class="n">Equals</span><span class="p">(</span><span class="n">accessType</span><span class="p">)).</span><span class="n">FirstOrDefault</span><span class="p">()</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="kt">var</span> <span class="n">perms</span> <span class="p">=</span> <span class="n">_permissions</span><span class="p">.</span><span class="n">Where</span><span class="p">(</span><span class="n">p</span> <span class="p">=&gt;</span> <span class="n">p</span><span class="p">.</span><span class="n">Object</span><span class="p">.</span><span class="n">Equals</span><span class="p">(</span><span class="n">o</span><span class="p">.</span><span class="n">GetType</span><span class="p">().</span><span class="n">Name</span><span class="p">)).</span><span class="n">ToList</span><span class="p">();</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">IndividualDeny</span><span class="p">(</span><span class="n">perms</span><span class="p">,</span> <span class="n">o</span><span class="p">,</span> <span class="n">accessType</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">GlobalPermit</span><span class="p">(</span><span class="n">perms</span><span class="p">,</span> <span class="n">o</span><span class="p">,</span> <span class="n">accessType</span><span class="p">)</span> <span class="p">||</span> <span class="n">IndividualPermit</span><span class="p">(</span><span class="n">perms</span><span class="p">,</span> <span class="n">o</span><span class="p">,</span> <span class="n">accessType</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="kt">bool</span> <span class="nf">GlobalPermit</span><span class="p">(</span><span class="n">List</span><span class="p">&lt;</span><span class="n">ObjectPermission</span><span class="p">&gt;</span> <span class="n">perms</span><span class="p">,</span> <span class="kt">object</span> <span class="n">o</span><span class="p">,</span> <span class="n">AccessType</span> <span class="n">accessType</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">accessType</span> <span class="p">==</span> <span class="n">ObjectLevelSecurity</span><span class="p">.</span><span class="n">AccessType</span><span class="p">.</span><span class="n">Write</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">perms</span><span class="p">.</span><span class="n">Where</span><span class="p">(</span><span class="n">p</span> <span class="p">=&gt;</span> <span class="n">p</span><span class="p">.</span><span class="n">GrantType</span><span class="p">.</span><span class="n">Equals</span><span class="p">(</span><span class="n">GrantType</span><span class="p">.</span><span class="n">Permit</span><span class="p">)</span> <span class="p">&amp;&amp;</span> <span class="n">p</span><span class="p">.</span><span class="n">AccessType</span><span class="p">.</span><span class="n">Equals</span><span class="p">(</span><span class="n">accessType</span><span class="p">)</span> <span class="p">&amp;&amp;</span> <span class="kt">string</span><span class="p">.</span><span class="n">IsNullOrEmpty</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">LimitingField</span><span class="p">)).</span><span class="n">Count</span><span class="p">()</span> <span class="p">==</span> <span class="m">1</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">perms</span><span class="p">.</span><span class="n">Where</span><span class="p">(</span><span class="n">p</span> <span class="p">=&gt;</span> <span class="n">p</span><span class="p">.</span><span class="n">GrantType</span><span class="p">.</span><span class="n">Equals</span><span class="p">(</span><span class="n">GrantType</span><span class="p">.</span><span class="n">Permit</span><span class="p">)</span> <span class="p">&amp;&amp;</span> <span class="kt">string</span><span class="p">.</span><span class="n">IsNullOrEmpty</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">LimitingField</span><span class="p">)).</span><span class="n">Count</span><span class="p">()</span> <span class="p">==</span> <span class="m">1</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="kt">bool</span> <span class="nf">IndividualDeny</span><span class="p">(</span><span class="n">List</span><span class="p">&lt;</span><span class="n">ObjectPermission</span><span class="p">&gt;</span> <span class="n">perms</span><span class="p">,</span> <span class="kt">object</span> <span class="n">o</span><span class="p">,</span> <span class="n">AccessType</span> <span class="n">accessType</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">var</span> <span class="n">attrPerms</span> <span class="p">=</span> <span class="n">perms</span><span class="p">.</span><span class="n">Where</span><span class="p">(</span><span class="n">p</span> <span class="p">=&gt;</span> <span class="p">!</span><span class="kt">string</span><span class="p">.</span><span class="n">IsNullOrEmpty</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">LimitingField</span><span class="p">)</span>
                        <span class="p">&amp;&amp;</span> <span class="n">p</span><span class="p">.</span><span class="n">GrantType</span><span class="p">.</span><span class="n">Equals</span><span class="p">(</span><span class="n">GrantType</span><span class="p">.</span><span class="n">Deny</span><span class="p">)</span> <span class="p">&amp;&amp;</span> <span class="n">p</span><span class="p">.</span><span class="n">AccessType</span><span class="p">.</span><span class="n">Equals</span><span class="p">(</span><span class="n">accessType</span><span class="p">)).</span><span class="n">ToList</span><span class="p">();</span>

        <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">perm</span> <span class="k">in</span> <span class="n">attrPerms</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">o</span><span class="p">.</span><span class="n">GetType</span><span class="p">().</span><span class="n">GetProperty</span><span class="p">(</span><span class="n">perm</span><span class="p">.</span><span class="n">LimitingField</span><span class="p">).</span><span class="n">GetValue</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="k">null</span><span class="p">).</span><span class="n">ToString</span><span class="p">().</span><span class="n">Equals</span><span class="p">(</span><span class="n">perm</span><span class="p">.</span><span class="n">LimitingField</span><span class="p">))</span> <span class="p">{</span>
                <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="kt">bool</span> <span class="nf">IndividualPermit</span><span class="p">(</span><span class="n">List</span><span class="p">&lt;</span><span class="n">ObjectPermission</span><span class="p">&gt;</span> <span class="n">perms</span><span class="p">,</span> <span class="kt">object</span> <span class="n">o</span><span class="p">,</span> <span class="n">AccessType</span> <span class="n">accessType</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">var</span> <span class="n">attrPerms</span> <span class="p">=</span> <span class="n">perms</span><span class="p">.</span><span class="n">Where</span><span class="p">(</span><span class="n">p</span> <span class="p">=&gt;</span> <span class="p">!</span><span class="kt">string</span><span class="p">.</span><span class="n">IsNullOrEmpty</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">LimitingField</span><span class="p">)</span> <span class="p">&amp;&amp;</span> <span class="n">p</span><span class="p">.</span><span class="n">GrantType</span><span class="p">.</span><span class="n">Equals</span><span class="p">(</span><span class="n">GrantType</span><span class="p">.</span><span class="n">Permit</span><span class="p">)).</span><span class="n">ToList</span><span class="p">();</span>

        <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">perm</span> <span class="k">in</span> <span class="n">attrPerms</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">accessType</span><span class="p">.</span><span class="n">Equals</span><span class="p">(</span><span class="n">ObjectLevelSecurity</span><span class="p">.</span><span class="n">AccessType</span><span class="p">.</span><span class="n">Write</span><span class="p">))</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">o</span><span class="p">.</span><span class="n">GetType</span><span class="p">().</span><span class="n">GetProperty</span><span class="p">(</span><span class="n">perm</span><span class="p">.</span><span class="n">LimitingField</span><span class="p">).</span><span class="n">GetValue</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="k">null</span><span class="p">).</span><span class="n">ToString</span><span class="p">().</span><span class="n">Equals</span><span class="p">(</span><span class="n">perm</span><span class="p">.</span><span class="n">LimitingValue</span><span class="p">)</span>
                    <span class="p">&amp;&amp;</span> <span class="n">perm</span><span class="p">.</span><span class="n">AccessType</span><span class="p">.</span><span class="n">Equals</span><span class="p">(</span><span class="n">accessType</span><span class="p">))</span> <span class="p">{</span>
                    <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="k">else</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">o</span><span class="p">.</span><span class="n">GetType</span><span class="p">().</span><span class="n">GetProperty</span><span class="p">(</span><span class="n">perm</span><span class="p">.</span><span class="n">LimitingField</span><span class="p">).</span><span class="n">GetValue</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="k">null</span><span class="p">).</span><span class="n">ToString</span><span class="p">().</span><span class="n">Equals</span><span class="p">(</span><span class="n">perm</span><span class="p">.</span><span class="n">LimitingValue</span><span class="p">))</span> <span class="p">{</span>
                    <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></div>


<p>This hopefully isn&rsquo;t too intimidating. Keep in mind that this enforcer assumes you must be explicitly granted permissions to something before you&rsquo;ll be able to see it. For that reason the &ldquo;All&rdquo; check exists so you can grant access to administrators on everything in your system. The other important bit about this is the SecureList() method. Slapping this code in your project won&rsquo;t magically secure up everything, you actually have to pass a list through the enforcer, which you can think of as a filter. The objects that come out the other end are those the user can view.</p>

<p>And finally we have a very basic implementation of this.</p>

<div class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="kt">var</span> <span class="n">products</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">Product</span><span class="p">&gt;();</span>
<span class="n">products</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="k">new</span> <span class="n">Product</span><span class="p">()</span> <span class="p">{</span><span class="n">ProductId</span> <span class="p">=</span> <span class="m">1</span><span class="p">,</span> <span class="n">Name</span> <span class="p">=</span> <span class="s">&quot;First&quot;</span><span class="p">});</span>
<span class="n">products</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="k">new</span> <span class="n">Product</span><span class="p">()</span> <span class="p">{</span><span class="n">ProductId</span> <span class="p">=</span> <span class="m">2</span><span class="p">,</span> <span class="n">Name</span> <span class="p">=</span> <span class="s">&quot;Second&quot;</span><span class="p">});</span>

<span class="kt">var</span> <span class="n">perms</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">ObjectPermission</span><span class="p">&gt;();</span>

<span class="n">perms</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="k">new</span> <span class="n">ObjectPermission</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">ObjectPermissionId</span> <span class="p">=</span> <span class="m">1</span><span class="p">,</span>
    <span class="n">UserId</span> <span class="p">=</span> <span class="m">1</span><span class="p">,</span>
    <span class="n">GrantType</span> <span class="p">=</span> <span class="n">ObjectLevelSecurity</span><span class="p">.</span><span class="n">GrantType</span><span class="p">.</span><span class="n">Permit</span><span class="p">,</span>
    <span class="n">AccessType</span> <span class="p">=</span> <span class="n">ObjectLevelSecurity</span><span class="p">.</span><span class="n">AccessType</span><span class="p">.</span><span class="n">Read</span><span class="p">,</span>
    <span class="n">Object</span> <span class="p">=</span> <span class="s">&quot;Product&quot;</span><span class="p">,</span>
    <span class="n">LimitingField</span> <span class="p">=</span> <span class="s">&quot;Name&quot;</span><span class="p">,</span>
    <span class="n">LimitingValue</span> <span class="p">=</span> <span class="s">&quot;Second&quot;</span>
<span class="p">});</span>

<span class="kt">var</span> <span class="n">enforcer</span> <span class="p">=</span> <span class="k">new</span> <span class="n">ObjectPermissionEnforcer</span><span class="p">(</span><span class="n">perms</span><span class="p">);</span>
Â 
<span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&quot;Read Access:&quot;</span><span class="p">);</span>
<span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">p</span> <span class="k">in</span> <span class="n">enforcer</span><span class="p">.</span><span class="n">SecureList</span><span class="p">&lt;</span><span class="n">Product</span><span class="p">&gt;(</span><span class="n">products</span><span class="p">,</span> <span class="n">AccessType</span><span class="p">.</span><span class="n">Read</span><span class="p">))</span> <span class="p">{</span>
    <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">Name</span><span class="p">);</span>
<span class="p">}</span>
<span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">();</span>

<span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&quot;Write Access:&quot;</span><span class="p">);</span>
<span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">p</span> <span class="k">in</span> <span class="n">enforcer</span><span class="p">.</span><span class="n">SecureList</span><span class="p">&lt;</span><span class="n">Product</span><span class="p">&gt;(</span><span class="n">products</span><span class="p">,</span> <span class="n">AccessType</span><span class="p">.</span><span class="n">Write</span><span class="p">))</span> <span class="p">{</span>
    <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">Name</span><span class="p">);</span>
<span class="p">}</span>
<span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">();</span></code></pre></div>


<p>Basically I setup a single permission for a user granting them read access to products that have a name of &ldquo;Second&rdquo;.</p>

<p>If you want to use this in the real world you&rsquo;ll certainly have to extend a few things. I had really wanted to put together an example complete with a database schema for you but I forgot Entity Framework doesn&rsquo;t currently support enums. After I realized, I mean remembered, that, I sort of gave up on that. You can see though that you could grab the permissions for the current user from your persistence layer, push those into the enforcer, and then secure whatever you like. Something you might want to do is create some extension methods, perhaps extending object or maybe you have a MyObjectBase type class that all your other classes inherit from. That way you can verify object very easily one object at a time.</p>

<p>And that&rsquo;s the show for today. I hope you enjoyed it, and we&rsquo;ll see you back here real soon! Right?</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Brad Teller</span></span>

      




<time class='entry-date' datetime='2012-01-18T00:00:00-05:00'><span class='date'><span class='date-month'>Jan</span> <span class='date-day'>18</span><span class='date-suffix'>th</span>, <span class='date-year'>2012</span></span> <span class='time'>12:00 am</span></time>
      


    </p>
    
      <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://bradteller.com/blog/2012/01/18/object-level-security/" data-via="bradteller" data-counturl="http://bradteller.com/blog/2012/01/18/object-level-security/" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium"></div>
  
  
    <div class="fb-like" data-send="true" data-width="450" data-show-faces="false"></div>
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2011/12/20/selectfor-helper/" title="Previous Post: SelectFor Helper">&laquo; SelectFor Helper</a>
      
      
        <a class="basic-alignment right" href="/blog/2012/01/18/the-weekly-bookshelf/" title="Next Post: The Weekly Bookshelf">The Weekly Bookshelf &raquo;</a>
      
    </p>
  </footer>
</article>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2015/07/01/responsive-now/">Start Planning for Responsive Design, NOW!</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/12/15/pdiff-the-right-way/">Perceptual Differencing, the Right Way!</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/07/02/tfs-build-getting-better/">TFS Build Might Be Getting Better</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/04/16/maybe-oneget-is-for/">Maybe I Know What OneGet Is For</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/04/11/what-is-oneget/">OneGet... What For?</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/bteller">@bteller</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'bteller',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>





  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2015 - Brad Teller -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
