
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Delegate Assist in the DAL - Brad Teller</title>
  <meta name="author" content="Brad Teller">

  
  <meta name="description" content="Not sure about the rest of you out there, but we are still utilizing a hand rolled data access layer. In certain cases we can make use of ORM tools, &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://bradteller.com/blog/2011/09/02/delegate-assist-in-dal/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Brad Teller" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Brad Teller</a></h1>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="sitesearch" value="bradteller.com">
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Delegate Assist in the DAL</h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2011-09-02T00:00:00-04:00'><span class='date'><span class='date-month'>Sep</span> <span class='date-day'>2</span><span class='date-suffix'>nd</span>, <span class='date-year'>2011</span></span> <span class='time'>12:00 am</span></time>
        
      </p>
    
  </header>


<div class="entry-content"><p>Not sure about the rest of you out there, but we are still utilizing a hand rolled data access layer. In certain cases we can make use of ORM tools, but for others we still need the additional control allowed by writing our own. One common task we do is to perform straight read queries into the database and then convert the returned result into a list of business objects. This gets very tedious and time consuming what with writing all the using statements. Also, if you consider the iteration over records in the data reader, that code isn&rsquo;t unique. So, if you want to reduce the overall amount of code this would be a great time to make use of delegates and generics. The code below should get you closer to something just a bit more manageable, since I know we all hate writing any more code than we absolutely have to.</p>

<p>First we define our delegate. We&rsquo;ll use this to tell our function what conversion function it should use for each object type.</p>

<div class="highlight"><pre><code class="language-vbnet" data-lang="vbnet"><span class="k">Public</span> <span class="k">Delegate</span> <span class="k">Function</span> <span class="nf">GetItemFromReader</span><span class="p">(</span><span class="k">Of</span> <span class="n">T</span><span class="p">)(</span><span class="k">ByVal</span> <span class="n">dr</span> <span class="ow">As</span> <span class="n">IDataReader</span><span class="p">)</span></code></pre></div>


<p>Then we can write a reusable function that will accepts an instance of our delegate as a parameter. We have some other helper functions out there which is where the &lsquo;Me.ExecuteReader&rsquo; call comes into play, but you could replace this with the traditional &lsquo;Using cn as New SqlConnection(_connString) &hellip;. End Using&rsquo; code.</p>

<div class="highlight"><pre><code class="language-vbnet" data-lang="vbnet"><span class="k">Public</span> <span class="k">Function</span> <span class="nf">GetListFromReader</span><span class="p">(</span><span class="k">Of</span> <span class="n">T</span><span class="p">)(</span><span class="k">ByVal</span> <span class="n">sprocName</span> <span class="ow">As</span> <span class="kt">String</span><span class="p">,</span> <span class="n">_</span>
          <span class="k">ByVal</span> <span class="n">params</span> <span class="ow">As</span> <span class="n">SqlParameter</span><span class="p">(),</span> <span class="n">_</span>
          <span class="k">ByVal</span> <span class="n">converter</span> <span class="ow">As</span> <span class="n">GetItemFromReader</span><span class="p">(</span><span class="k">Of</span> <span class="n">T</span><span class="p">))</span> <span class="ow">As</span> <span class="n">List</span><span class="p">(</span><span class="k">Of</span> <span class="n">T</span><span class="p">)</span>
 
    <span class="k">Dim</span> <span class="n">result</span> <span class="ow">As</span> <span class="k">New</span> <span class="n">List</span><span class="p">(</span><span class="k">Of</span> <span class="n">T</span><span class="p">)</span>

    <span class="k">Using</span> <span class="n">dr</span> <span class="ow">As</span> <span class="n">SqlDataReader</span> <span class="o">=</span> <span class="k">Me</span><span class="p">.</span><span class="n">ExecuteReader</span><span class="p">(</span><span class="n">sprocName</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
        <span class="k">While</span> <span class="n">dr</span><span class="p">.</span><span class="n">Read</span>
            <span class="n">result</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">converter</span><span class="p">(</span><span class="n">dr</span><span class="p">))</span>
        <span class="k">End</span> <span class="k">While</span>
    <span class="k">End</span> <span class="k">Using</span>
 
    <span class="k">Return</span> <span class="n">result</span>
<span class="k">End</span> <span class="k">Function</span></code></pre></div>


<p>And then we can go ahead and consume it.</p>

<div class="highlight"><pre><code class="language-vbnet" data-lang="vbnet"><span class="k">Public</span> <span class="k">Function</span> <span class="nf">GetUsers</span><span class="p">()</span> <span class="ow">As</span> <span class="n">ICollection</span><span class="p">(</span><span class="k">Of</span> <span class="n">User</span><span class="p">)</span>
    <span class="k">Return</span> <span class="n">GetListFromReader</span><span class="p">(</span><span class="k">Of</span> <span class="n">User</span><span class="p">)(</span><span class="s">&quot;getUsers&quot;</span><span class="p">,</span> <span class="k">Nothing</span><span class="p">,</span> <span class="ow">AddressOf</span> <span class="n">GetUserFromDataReader</span><span class="p">)</span>
<span class="k">End</span> <span class="k">Function</span></code></pre></div>


<p>The code that does the conversion is:</p>

<div class="highlight"><pre><code class="language-vbnet" data-lang="vbnet"><span class="k">Private</span> <span class="k">Function</span> <span class="nf">GetUserFromDataReader</span><span class="p">(</span><span class="k">ByVal</span> <span class="n">dr</span> <span class="ow">As</span> <span class="n">IDataReader</span><span class="p">)</span> <span class="ow">As</span> <span class="n">User</span>
    <span class="k">Return</span> <span class="k">New</span> <span class="n">User</span> <span class="k">With</span> <span class="p">{.</span><span class="n">Id</span> <span class="o">=</span> <span class="n">dr</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">),</span> <span class="p">.</span><span class="n">Name</span> <span class="o">=</span> <span class="n">dr</span><span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">)}</span>
<span class="k">End</span> <span class="k">Function</span></code></pre></div>

</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Brad Teller</span></span>

      




<time class='entry-date' datetime='2011-09-02T00:00:00-04:00'><span class='date'><span class='date-month'>Sep</span> <span class='date-day'>2</span><span class='date-suffix'>nd</span>, <span class='date-year'>2011</span></span> <span class='time'>12:00 am</span></time>
      


    </p>
    
      <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://bradteller.com/blog/2011/09/02/delegate-assist-in-dal/" data-via="bradteller" data-counturl="http://bradteller.com/blog/2011/09/02/delegate-assist-in-dal/" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium"></div>
  
  
    <div class="fb-like" data-send="true" data-width="450" data-show-faces="false"></div>
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2011/08/31/what-up-with-massive/" title="Previous Post: What's Up With Massive?">&laquo; What's Up With Massive?</a>
      
      
        <a class="basic-alignment right" href="/blog/2011/09/28/htmlselectforenum-extension-for-mvc/" title="Next Post: Html.SelectForEnum Extension for MVC">Html.SelectForEnum Extension for MVC &raquo;</a>
      
    </p>
  </footer>
</article>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2015/07/01/responsive-now/">Start Planning for Responsive Design, NOW!</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/12/15/pdiff-the-right-way/">Perceptual Differencing, the Right Way!</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/07/02/tfs-build-getting-better/">TFS Build Might Be Getting Better</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/04/16/maybe-oneget-is-for/">Maybe I Know What OneGet Is For</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/04/11/what-is-oneget/">OneGet... What For?</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/bteller">@bteller</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'bteller',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>





  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2015 - Brad Teller -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
